<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D Game - Circular Arena</title>
    <style>
        canvas {
            display: block;
            margin: 0 auto;
            background-color: #ccc;
            border: 2px solid black;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Player objects
        const player1 = { x: 150, y: 180, width: 20, height: 20, color: 'red', speed: 2, dx: 0, dy: 0 };
        const player2 = { x: 230, y: 180, width: 20, height: 20, color: 'blue', speed: 2, dx: 0, dy: 0 };

        // Key states
        const keys = {};

        // Circle properties
        const circle = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            radius: 150,
            color: '#333'
        };

        window.addEventListener('keydown', (e) => keys[e.key] = true);
        window.addEventListener('keyup', (e) => keys[e.key] = false);

        function update() {
            // Reset velocities
            player1.dx = 0;
            player1.dy = 0;
            player2.dx = 0;
            player2.dy = 0;

            // Player 1 controls (WASD)
            if (keys['w']) player1.dy = -player1.speed;
            if (keys['s']) player1.dy = player1.speed;
            if (keys['a']) player1.dx = -player1.speed;
            if (keys['d']) player1.dx = player1.speed;

            // Player 2 controls (Arrow keys)
            if (keys['ArrowUp']) player2.dy = -player2.speed;
            if (keys['ArrowDown']) player2.dy = player2.speed;
            if (keys['ArrowLeft']) player2.dx = -player2.speed;
            if (keys['ArrowRight']) player2.dx = player2.speed;

            // Update positions with collision handling
            movePlayer(player1, player2);
            movePlayer(player2, player1);

            // Check collision with circle
            if (!isInsideCircle(player1)) declareWinner(2);
            if (!isInsideCircle(player2)) declareWinner(1);

            // Keep players within canvas bounds
            player1.x = Math.max(0, Math.min(canvas.width - player1.width, player1.x));
            player1.y = Math.max(0, Math.min(canvas.height - player1.height, player1.y));

            player2.x = Math.max(0, Math.min(canvas.width - player2.width, player2.x));
            player2.y = Math.max(0, Math.min(canvas.height - player2.height, player2.y));
        }

        function movePlayer(player, otherPlayer) {
            const nextX = player.x + player.dx;
            const nextY = player.y + player.dy;

            // Predict collision with the other player
            if (
                nextX < otherPlayer.x + otherPlayer.width &&
                nextX + player.width > otherPlayer.x &&
                nextY < otherPlayer.y + otherPlayer.height &&
                nextY + player.height > otherPlayer.y
            ) {
                // Push the other player
                if (player.dx > 0) otherPlayer.x += player.dx;
                if (player.dx < 0) otherPlayer.x += player.dx;
                if (player.dy > 0) otherPlayer.y += player.dy;
                if (player.dy < 0) otherPlayer.y += player.dy;
            } else {
                // Move the player normally
                player.x = nextX;
                player.y = nextY;
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw outer square
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, 0, canvas.width, canvas.height);

            // Draw inner circle
            ctx.fillStyle = circle.color;
            ctx.beginPath();
            ctx.arc(circle.x, circle.y, circle.radius, 0, Math.PI * 2);
            ctx.fill();

            // Draw players
            ctx.fillStyle = player1.color;
            ctx.fillRect(player1.x, player1.y, player1.width, player1.height);

            ctx.fillStyle = player2.color;
            ctx.fillRect(player2.x, player2.y, player2.width, player2.height);
        }

        function isInsideCircle(player) {
            const dx = player.x + player.width / 2 - circle.x;
            const dy = player.y + player.height / 2 - circle.y;
            return Math.sqrt(dx * dx + dy * dy) <= circle.radius;
        }

        function declareWinner(winner) {
            alert(`Player ${winner} wins!`);
            resetGame();
        }

        function resetGame() {
            player1.x = 150;
            player1.y = 180;
            player1.dx = 0;
            player1.dy = 0;

            player2.x = 230;
            player2.y = 180;
            player2.dx = 0;
            player2.dy = 0;
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        gameLoop(); // Start the game loop
    </script>
</body>
</html>
